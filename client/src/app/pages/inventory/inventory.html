<div class="inventory-wrapper">
  <!-- Pipeline Sidebar -->
  <aside class="pipeline-sidebar">
    <div class="pipeline-header">
      <h3 class="pipeline-title">Pipeline d'inventaire</h3>
    </div>
    
    <div class="pipeline-steps">
      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'upload'"
        (click)="currentStep.set('upload')"
      >
        <span class="step-number">1</span>
        <span class="step-label">Importer CSV</span>
      </button>

      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'preview'"
        [disabled]="csvData().length === 0"
        (click)="currentStep.set('preview')"
      >
        <span class="step-number">2</span>
        <span class="step-label">Aperçu</span>
      </button>

      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'tuning'"
        [disabled]="csvData().length === 0"
        (click)="currentStep.set('tuning')"
      >
        <span class="step-number">3</span>
        <span class="step-label">Paramètres</span>
      </button>

      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'qrcode'"
        [disabled]="csvData().length === 0"
        (click)="currentStep.set('qrcode')"
      >
        <span class="step-number">4</span>
        <span class="step-label">Code QR</span>
      </button>

      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'detection'"
        [disabled]="csvData().length === 0"
        (click)="currentStep.set('detection')"
      >
        <span class="step-number">5</span>
        <span class="step-label">Détection</span>
      </button>
    </div>

    <div class="pipeline-footer">
      <button class="reset-btn" (click)="resetPipeline()">
        ↻ Réinitialiser
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="inventory-main">
    <!-- Step: Upload CSV -->
    @if (currentStep() === 'upload') {
      <app-inventory-upload
        [uploadError]="uploadError()"
        [recordCount]="csvData().length"
        (fileUploaded)="handleFileUpload($event)"
      />
    }

    <!-- Step: Preview -->
    @if (currentStep() === 'preview') {
      <app-inventory-preview
        [detectedColumns]="detectedColumns()"
        [columnMappings]="columnMappings()"
        [rawCsvRows]="rawCsvRows()"
        [bookCount]="csvData().length"
        [quantityWarningMessage]="quantityWarningMessage()"
        (columnMappingChanged)="onColumnMappingChange($event.columnName, $event.event)"
      />
    }

    <!-- Step: Tuning -->
    @if (currentStep() === 'tuning') {
      <app-inventory-tuning />
    }

    <!-- Step: QR Code -->
    @if (currentStep() === 'qrcode') {
      <app-inventory-qrcode />
    }

    <!-- Step: Detection -->
    @if (currentStep() === 'detection') {
      <app-inventory-detection />
    }

    <!-- Navigation Buttons -->
    <div class="step-navigation">
      <button 
        class="nav-btn nav-btn-secondary"
        (click)="moveToPreviousStep()"
        [disabled]="currentStep() === 'upload'"
      >
        ← Précédent
      </button>

      <button 
        class="nav-btn nav-btn-primary"
        (click)="moveToNextStep()"
        [disabled]="!canProceedToNextStep()"
      >
        Suivant →
      </button>
    </div>
  </main>
</div>
