<div class="inventory-wrapper">
  <!-- Pipeline Sidebar -->
  <aside class="pipeline-sidebar">
    <div class="pipeline-header">
      <h3 class="pipeline-title">Pipeline d'inventaire</h3>
    </div>
    
    <div class="pipeline-steps">
      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'upload'"
        (click)="currentStep.set('upload')"
      >
        <span class="step-number">1</span>
        <span class="step-label">Importer CSV</span>
      </button>

      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'preview'"
        [disabled]="csvData().length === 0"
        (click)="currentStep.set('preview')"
      >
        <span class="step-number">2</span>
        <span class="step-label">Aper√ßu</span>
      </button>

      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'tuning'"
        [disabled]="csvData().length === 0"
        (click)="currentStep.set('tuning')"
      >
        <span class="step-number">3</span>
        <span class="step-label">Param√®tres</span>
      </button>

      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'qrcode'"
        [disabled]="csvData().length === 0"
        (click)="currentStep.set('qrcode')"
      >
        <span class="step-number">4</span>
        <span class="step-label">Code QR</span>
      </button>

      <button 
        class="pipeline-step"
        [class.active]="currentStep() === 'detection'"
        [disabled]="csvData().length === 0"
        (click)="currentStep.set('detection')"
      >
        <span class="step-number">5</span>
        <span class="step-label">D√©tection</span>
      </button>
    </div>

    <div class="pipeline-footer">
      <button class="reset-btn" (click)="resetPipeline()">
        ‚Üª R√©initialiser
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="inventory-main">
    <!-- Step: Upload CSV -->
    @if (currentStep() === 'upload') {
      <section class="step-content">
        <div class="step-header">
          <h2 class="step-title">Importer votre base de donn√©es</h2>
          <p class="step-description">T√©l√©chargez un fichier CSV contenant votre liste de livres</p>
        </div>

        <!-- Upload Area -->
        <div 
          class="upload-area"
          [class.dragging]="isDraggingOver()"
          (dragover)="onDragOver($event)"
          (dragleave)="onDragLeave($event)"
          (drop)="onDrop($event)"
        >
          <div class="upload-content">
            <span class="upload-icon">üìÅ</span>
            <p class="upload-text">Glissez-d√©posez votre fichier CSV ici</p>
            <p class="upload-or">ou</p>
            <label class="upload-label">
              Parcourir mon ordinateur
              <input 
                type="file" 
                accept=".csv"
                (change)="onFileSelected($event)"
                hidden
              />
            </label>
          </div>
        </div>

        <!-- Error Message -->
        @if (uploadError()) {
          <div class="error-message">
            ‚ö†Ô∏è {{ uploadError() }}
          </div>
        }

        <!-- File Info -->
        @if (fileName()) {
          <div class="file-info">
            <span class="file-icon">‚úì</span>
            <span class="file-name">{{ fileName() }}</span>
            <span class="record-count">{{ csvData().length }} livres</span>
          </div>
        }

        <!-- CSV Format Guide -->
        <div class="csv-guide">
          <h4 class="guide-title">Format attendu</h4>
          <p class="guide-text">Votre fichier CSV doit contenir les colonnes suivantes :</p>
          <ul class="guide-list">
            <li><strong>Titre</strong> - Titre du livre</li>
            <li><strong>Auteur</strong> - Auteur du livre</li>
            <li><strong>ISBN</strong> (optionnel) - Code ISBN</li>
            <li><strong>Quantit√©</strong> (optionnel) - Nombre de copies</li>
          </ul>
        </div>
      </section>
    }

    <!-- Step: Preview -->
    @if (currentStep() === 'preview') {
      <section class="step-content">
        <div class="step-header">
          <h2 class="step-title">Aper√ßu de vos donn√©es</h2>
          <p class="step-description">{{ csvData().length }} livres d√©tect√©s</p>
        </div>

        <!-- Table Preview -->
        <div class="preview-container">
          <div class="table-wrapper">
            <table class="preview-table">
              <thead>
                <tr>
                  <th>Titre</th>
                  <th>Auteur</th>
                  <th>ISBN</th>
                  <th>Quantit√©</th>
                </tr>
              </thead>
              <tbody>
                @for (book of csvData().slice(0, 10); track book.title + book.author) {
                  <tr>
                    <td>{{ book.title }}</td>
                    <td>{{ book.author }}</td>
                    <td>{{ book.isbn || '‚Äî' }}</td>
                    <td class="qty-cell">{{ formatNumber(book.quantity) }}</td>
                  </tr>
                }
              </tbody>
            </table>
          </div>

          @if (csvData().length > 10) {
            <p class="preview-note">Affichage des 10 premiers livres ({{ csvData().length }} au total)</p>
          }
        </div>
      </section>
    }

    <!-- Step: Tuning -->
    @if (currentStep() === 'tuning') {
      <section class="step-content">
        <div class="step-header">
          <h2 class="step-title">Param√®tres de d√©tection</h2>
          <p class="step-description">Configurez les param√®tres pour optimiser la d√©tection</p>
        </div>

        <div class="tuning-container">
          <div class="parameter-group">
            <label class="parameter-label">Seuil de confiance</label>
            <input type="range" min="0" max="100" value="75" class="parameter-slider" />
            <span class="parameter-value">75%</span>
          </div>

          <div class="parameter-group">
            <label class="parameter-label">Sensibilit√© de d√©tection</label>
            <input type="range" min="0" max="100" value="80" class="parameter-slider" />
            <span class="parameter-value">80%</span>
          </div>

          <div class="parameter-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" checked />
              Afficher les pr√©dictions en temps r√©el
            </label>
          </div>

          <div class="parameter-group checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" checked />
              Demander confirmation pour chaque livre
            </label>
          </div>
        </div>
      </section>
    }

    <!-- Step: QR Code -->
    @if (currentStep() === 'qrcode') {
      <section class="step-content">
        <div class="step-header">
          <h2 class="step-title">Code QR pour l'application mobile</h2>
          <p class="step-description">Scannez ce code avec votre t√©l√©phone</p>
        </div>

        <div class="qrcode-container">
          <div class="qrcode-placeholder">
            üì± Code QR √† venir
          </div>
          <p class="qrcode-note">Connectez-vous sur votre t√©l√©phone et scannez ce code pour acc√©der √† l'outil de d√©tection</p>
        </div>
      </section>
    }

    <!-- Step: Detection -->
    @if (currentStep() === 'detection') {
      <section class="step-content">
        <div class="step-header">
          <h2 class="step-title">D√©tection en cours</h2>
          <p class="step-description">Utilisez la cam√©ra de votre t√©l√©phone pour scanner les rayons</p>
        </div>

        <div class="detection-container">
          <div class="status-box">
            <span class="status-icon">‚è≥</span>
            <p class="status-text">En attente de donn√©es de d√©tection...</p>
          </div>
          <p class="detection-note">Les r√©sultats de d√©tection appara√Ætront ici</p>
        </div>
      </section>
    }

    <!-- Navigation Buttons -->
    <div class="step-navigation">
      <button 
        class="nav-btn nav-btn-secondary"
        (click)="moveToPreviousStep()"
        [disabled]="currentStep() === 'upload'"
      >
        ‚Üê Pr√©c√©dent
      </button>

      <button 
        class="nav-btn nav-btn-primary"
        (click)="moveToNextStep()"
        [disabled]="!canProceedToNextStep()"
      >
        Suivant ‚Üí
      </button>
    </div>
  </main>
</div>
